<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>147 API å¿«é€Ÿæµ‹è¯•</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¤–</text></svg>">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0 auto;
      max-width: 900px;
      padding: 24px;
      background: #f7f7f7;
      color: #222;
    }

    h1 {
      font-size: 26px;
      margin-bottom: 8px;
    }

    p {
      margin-top: 0;
      color: #555;
    }

    form {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
    }

    .form-group {
      margin-bottom: 16px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 14px;
      box-sizing: border-box;
      background: #fff;
    }

    textarea {
      min-height: 90px;
      resize: vertical;
    }

    button {
      width: 100%;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      color: #fff;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(99, 102, 241, 0.25);
    }

    button:disabled {
      cursor: wait;
      background: #cbd5f5;
      box-shadow: none;
      transform: none;
    }

    .result {
      margin-top: 24px;
      padding: 16px;
      border-radius: 10px;
      background: #fff;
      border: 1px solid #e5e7eb;
      display: none;
    }

    .result.success {
      border-color: #bbf7d0;
      background: #f0fdf4;
      color: #14532d;
    }

    .result.error {
      border-color: #fecaca;
      background: #fef2f2;
      color: #7f1d1d;
    }

    .result.loading {
      border-color: #bae6fd;
      background: #f0f9ff;
      color: #0c4a6e;
    }

    .image-preview {
      margin-top: 24px;
      text-align: center;
      padding: 20px;
      background: #fff;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .image-preview img {
      max-width: 100%;
      max-height: 500px;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.12);
      transition: transform 0.2s ease;
    }

    .image-preview img:hover {
      transform: scale(1.02);
    }

    .image-preview p {
      margin: 0;
      padding: 10px;
      font-size: 14px;
    }

    .debug {
      margin-top: 24px;
      background: #0f172a;
      color: #e2e8f0;
      border-radius: 10px;
      padding: 18px;
      font-family: Menlo, Consolas, monospace;
      font-size: 13px;
      line-height: 1.5;
      white-space: pre-wrap;
      overflow-x: auto;
      display: none;
    }

    .section-title {
      margin-top: 32px;
      font-size: 18px;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <h1>147 API å¿«é€Ÿæµ‹è¯•</h1>
  <p>ç”¨äºå•ç‹¬éªŒè¯ 147 Banana API å¯ç”¨æ€§ã€‚åªåœ¨æœ¬åœ°è¿è¡Œï¼Œä¸ä¼šä¿å­˜ä»»ä½•å¯†é’¥ã€‚</p>

  <form id="testerForm">
    <div class="form-group">
      <label for="apiKey">147 API Key</label>
      <input id="apiKey" type="password" required placeholder="ä¾‹å¦‚ï¼šsk-xxxxxxxxxxxxxxxx" autocomplete="off" value="sk-WBd9sGus7I68Wwl9ivwfIBP148GzuF7ypLISfdUqlW5Ipj5P" />
      <small style="color: #28a745; font-size: 12px;">âœ… å·²é¢„è®¾æœ‰æ•ˆçš„API Keyï¼Œå¯ç›´æ¥æµ‹è¯•</small>
    </div>

    <div class="form-group">
      <label for="prompt">æç¤ºè¯</label>
      <textarea id="prompt" required>ç”»ä¸€åªå¯çˆ±çš„æ©˜çŒ«ï¼Œæˆ´ç€å¤ªç©ºå¤´ç›”ï¼Œåœ¨æœˆçƒæ¼«æ­¥ã€‚</textarea>
    </div>

    <div class="form-group">
      <label for="aspectRatio">é•¿å®½æ¯”</label>
      <select id="aspectRatio">
        <option value="">é»˜è®¤ (1:1)</option>
        <option value="1:1">1:1 æ­£æ–¹å½¢</option>
        <option value="3:4">3:4 ç«–å±</option>
        <option value="4:3">4:3 æ¨ªå±</option>
        <option value="9:16">9:16 æ‰‹æœºç«–å±</option>
        <option value="16:9">16:9 å®½å±</option>
      </select>
    </div>

    <div class="form-group">
      <label for="responseMode">å“åº”å†…å®¹</label>
      <select id="responseMode">
        <option value="both">å›¾åƒ + æ–‡æœ¬</option>
        <option value="image">ä»…å›¾åƒ</option>
        <option value="text">ä»…æ–‡æœ¬</option>
      </select>
    </div>

    <button type="submit" id="submitBtn">è°ƒç”¨ 147 API</button>
    <button type="button" id="testImageOnlyBtn" style="margin-top: 10px; background: linear-gradient(135deg, #10b981 0%, #059669 100%);">æµ‹è¯•ä»…å›¾åƒç”Ÿæˆ</button>
    <button type="button" id="pingTestBtn" style="margin-top: 10px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">Ping æµ‹è¯•å»¶è¿Ÿ</button>
  </form>

  <div id="result" class="result"></div>
  <div id="imagePreview" class="image-preview"></div>
  <div id="debug" class="debug"></div>

  <h2 class="section-title">å¦‚ä½•ä½¿ç”¨</h2>
  <ol>
    <li>ç›´æ¥ç”¨æµè§ˆå™¨æ‰“å¼€æœ¬é¡µé¢ (æ— éœ€èµ·æœåŠ¡å™¨)ã€‚</li>
    <li>ç²˜è´´ 147 æä¾›çš„ API Keyï¼Œè¾“å…¥æç¤ºè¯åç‚¹å‡»ã€Œè°ƒç”¨ 147 APIã€ã€‚</li>
    <li>è‹¥æˆåŠŸï¼Œä¼šåœ¨ä¸‹æ–¹æ˜¾ç¤ºç”Ÿæˆå›¾ï¼Œä»¥åŠæ¥å£åŸå§‹å“åº”ã€‚</li>
    <li>è‹¥å¤±è´¥ï¼Œè¯·å¤åˆ¶è°ƒè¯•ä¿¡æ¯åé¦ˆæˆ–è‡ªè¡Œå®šä½é—®é¢˜ã€‚</li>
    <li><strong>æ–°å¢åŠŸèƒ½ï¼š</strong>ç‚¹å‡»ã€ŒPing æµ‹è¯•å»¶è¿Ÿã€å¯ä»¥æµ‹è¯•åˆ° 147 API çš„ç½‘ç»œå»¶è¿Ÿå’Œè¿æ¥ç¨³å®šæ€§ã€‚</li>
  </ol>

  <script>
    const form = document.getElementById('testerForm');
    const submitBtn = document.getElementById('submitBtn');
    const resultDiv = document.getElementById('result');
    const imagePreview = document.getElementById('imagePreview');
    const debugDiv = document.getElementById('debug');

    const API_BASE = 'https://api1.147ai.com/v1beta/models';
    const MODEL = 'gemini-2.5-flash-image';

    function setResult(message, type) {
      resultDiv.style.display = 'block';
      resultDiv.className = `result ${type}`;
      resultDiv.textContent = message;
    }

    function resetUI() {
      resultDiv.style.display = 'none';
      imagePreview.innerHTML = '';
      debugDiv.style.display = 'none';
      debugDiv.textContent = '';
    }

    function buildAuthorizationHeader(apiKey) {
      if (!apiKey) {
        throw new Error('API Key ä¸èƒ½ä¸ºç©º');
      }
      // 147 API ä½¿ç”¨ sk- å¼€å¤´çš„å¯†é’¥ï¼Œå¦‚æœ‰ Bearer å‰ç¼€åˆ™å»æ‰
      return apiKey.replace(/^Bearer\s+/i, '').trim();
    }

    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      const apiKey = document.getElementById('apiKey').value.trim();
      const prompt = document.getElementById('prompt').value.trim();
      const aspectRatio = document.getElementById('aspectRatio').value;
      const responseMode = document.getElementById('responseMode').value;

      if (!apiKey || !prompt) {
        setResult('API Key å’Œæç¤ºè¯ä¸èƒ½ä¸ºç©º', 'error');
        return;
      }

      resetUI();
      submitBtn.disabled = true;
      setResult('æ­£åœ¨è°ƒç”¨ 147 API...', 'loading');

      const startTime = Date.now();

      const responseModalities = (() => {
        switch (responseMode) {
          case 'image':
            return ['IMAGE'];
          case 'text':
            return ['TEXT'];
          default:
            return ['TEXT', 'IMAGE'];
        }
      })();

      const body = {
        contents: [
          {
            role: 'user',
            parts: [
              { text: prompt },
            ],
          },
        ],
        safetySettings: [
          { category: 'HARM_CATEGORY_HARASSMENT', threshold: 'BLOCK_NONE' },
          { category: 'HARM_CATEGORY_HATE_SPEECH', threshold: 'BLOCK_NONE' },
          { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', threshold: 'BLOCK_NONE' },
          { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', threshold: 'BLOCK_NONE' },
          { category: 'HARM_CATEGORY_CIVIC_INTEGRITY', threshold: 'BLOCK_NONE' },
        ],
        generationConfig: {
          responseModalities,
        },
      };

      if (aspectRatio) {
        body.generationConfig.imageConfig = { aspectRatio };
      }

      // æ·»åŠ è°ƒè¯•ä¿¡æ¯
      console.log('ğŸš€ å¼€å§‹APIè°ƒç”¨:', {
        url: `${API_BASE}/${MODEL}:generateContent`,
        responseModalities,
        aspectRatio,
        startTime: new Date().toLocaleTimeString(),
        body: JSON.stringify(body, null, 2)
      });

      let fetchResponse;
      let responseJson;
      const url = `${API_BASE}/${MODEL}:generateContent`;

      try {
        fetchResponse = await fetch(url, {
          method: 'POST',
          headers: {
            'Authorization': buildAuthorizationHeader(apiKey),
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(body),
        });

        const rawText = await fetchResponse.text();
        debugDiv.style.display = 'block';
        debugDiv.textContent = `HTTP ${fetchResponse.status} ${fetchResponse.statusText}\n\n${rawText}`;

        if (!fetchResponse.ok) {
          setResult(`è°ƒç”¨å¤±è´¥ï¼šHTTP ${fetchResponse.status}`, 'error');
          return;
        }

        responseJson = JSON.parse(rawText);
        
        // è®°å½•APIå“åº”æ—¶é—´
        const apiResponseTime = Date.now();
        const apiDuration = apiResponseTime - startTime;
        console.log(`ğŸ“¡ APIå“åº”å®Œæˆï¼Œè€—æ—¶: ${(apiDuration / 1000).toFixed(2)}ç§’`);
        
      } catch (error) {
        const message = error instanceof Error ? error.message : String(error);
        setResult(`è¯·æ±‚å‡ºé”™ï¼š${message}`, 'error');
        debugDiv.style.display = 'block';
        debugDiv.textContent += `\n\nå¼‚å¸¸ä¿¡æ¯ï¼š${message}`;
        return;
      } finally {
        submitBtn.disabled = false;
      }

      const candidate = responseJson?.candidates?.[0];
      const parts = candidate?.content?.parts || [];
      let imageData = null;
      let textResponse = '';

      console.log('è§£æå“åº”æ•°æ®:', { candidate, parts });

      parts.forEach((part, index) => {
        console.log(`Part ${index}:`, part);
        if (typeof part.text === 'string') {
          textResponse += part.text;
        }
        if (part.inlineData?.data) {
          imageData = part.inlineData.data;
          console.log('æ‰¾åˆ°å›¾åƒæ•°æ®ï¼Œé•¿åº¦:', imageData.length);
        }
      });

      if (!imageData && !textResponse) {
        setResult('è°ƒç”¨æˆåŠŸä½†æœªè¿”å›å›¾åƒæˆ–æ–‡æœ¬ï¼Œè¯·æ£€æŸ¥å“åº”æ•°æ®ã€‚', 'error');
        return;
      }

      const endTime = Date.now();
      const totalTime = endTime - startTime;
      const timeSeconds = (totalTime / 1000).toFixed(2);

      let message = `è°ƒç”¨æˆåŠŸ (è€—æ—¶: ${timeSeconds}ç§’)`;
      if (textResponse) {
        message += `ï¼Œæ–‡æœ¬è¾“å‡ºï¼š${textResponse}`;
      }
      if (imageData) {
        message += `ï¼Œå›¾åƒæ•°æ®é•¿åº¦ï¼š${imageData.length} å­—ç¬¦`;
      }
      setResult(message, 'success');

      if (imageData) {
        try {
          // æ¸…ç†base64æ•°æ®
          const cleanImageData = imageData.replace(/\s+/g, '');
          console.log('æ¸…ç†åçš„å›¾åƒæ•°æ®é•¿åº¦:', cleanImageData.length);
          
          const img = document.createElement('img');
          img.src = `data:image/png;base64,${cleanImageData}`;
          img.alt = 'ç”Ÿæˆçš„å›¾åƒ';
          img.style.maxWidth = '100%';
          img.style.height = 'auto';
          img.style.borderRadius = '12px';
          img.style.border = '1px solid #e2e8f0';
          img.style.boxShadow = '0 8px 18px rgba(15, 23, 42, 0.12)';
          
          img.onload = () => {
            const imageLoadTime = Date.now();
            const imageLoadDuration = imageLoadTime - startTime;
            console.log(`å›¾åƒåŠ è½½æˆåŠŸï¼Œæ€»è€—æ—¶: ${(imageLoadDuration / 1000).toFixed(2)}ç§’`);
          };
          
          img.onerror = (error) => {
            console.error('å›¾åƒåŠ è½½å¤±è´¥:', error);
            imagePreview.innerHTML = '<p style="color: red;">å›¾åƒåŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥base64æ•°æ®æ ¼å¼</p>';
          };
          
          imagePreview.innerHTML = '';
          imagePreview.appendChild(img);
        } catch (error) {
          console.error('åˆ›å»ºå›¾åƒå…ƒç´ å¤±è´¥:', error);
          imagePreview.innerHTML = '<p style="color: red;">å›¾åƒæ˜¾ç¤ºå¤±è´¥: ' + error.message + '</p>';
        }
      } else {
        imagePreview.innerHTML = '<p style="color: #666;">æœªç”Ÿæˆå›¾åƒ</p>';
      }
    });

    // Ping æµ‹è¯•å»¶è¿ŸæŒ‰é’®
    document.getElementById('pingTestBtn').addEventListener('click', async () => {
      resetUI();
      setResult('æ­£åœ¨æµ‹è¯• 147 API å»¶è¿Ÿ...', 'loading');
      
      const pingResults = [];
      const testCount = 5; // æµ‹è¯•5æ¬¡
      const apiUrl = `${API_BASE}/${MODEL}:generateContent`;
      
      console.log('ğŸš€ å¼€å§‹ Ping æµ‹è¯•:', {
        url: apiUrl,
        testCount,
        startTime: new Date().toLocaleTimeString()
      });
      
      for (let i = 0; i < testCount; i++) {
        const startTime = performance.now();

        try {
          // å‘é€ä¸€ä¸ªç®€å•çš„OPTIONSè¯·æ±‚æµ‹è¯•è¿æ¥
          // OPTIONSæ˜¯æ ‡å‡†çš„CORSé¢„æ£€è¯·æ±‚ï¼Œç”¨æ¥æ£€æŸ¥APIå¯ç”¨æ€§
          const response = await fetch(apiUrl, {
            method: 'OPTIONS',
            headers: {
              'Authorization': buildAuthorizationHeader(document.getElementById('apiKey').value.trim()),
            },
          });

          const endTime = performance.now();
          const latency = endTime - startTime;

          pingResults.push({
            attempt: i + 1,
            latency: latency,
            status: response.status,
            success: true  // OPTIONS è¯·æ±‚é€šå¸¸è¿”å› 200-204ï¼Œè®¤ä¸ºæœ‰å“åº”å°±æ˜¯æˆåŠŸ
          });

          console.log(`Ping ${i + 1}: ${latency.toFixed(2)}ms (HTTP ${response.status})`);

        } catch (error) {
          const endTime = performance.now();
          const latency = endTime - startTime;

          pingResults.push({
            attempt: i + 1,
            latency: latency,
            status: 'ERROR',
            success: false,
            error: error.message
          });

          console.log(`Ping ${i + 1}: ${latency.toFixed(2)}ms (ERROR: ${error.message})`);
        }

        // æ¯æ¬¡æµ‹è¯•é—´éš”100ms
        if (i < testCount - 1) {
          await new Promise(resolve => setTimeout(resolve, 100));
        }
      }
      
      // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
      const successfulPings = pingResults.filter(p => p.success);
      const avgLatency = successfulPings.length > 0 
        ? successfulPings.reduce((sum, p) => sum + p.latency, 0) / successfulPings.length 
        : 0;
      const minLatency = successfulPings.length > 0 
        ? Math.min(...successfulPings.map(p => p.latency)) 
        : 0;
      const maxLatency = successfulPings.length > 0 
        ? Math.max(...successfulPings.map(p => p.latency)) 
        : 0;
      
      // æ˜¾ç¤ºç»“æœ
      let resultMessage = `Ping æµ‹è¯•å®Œæˆ (${testCount}æ¬¡æµ‹è¯•)\n`;
      resultMessage += `æˆåŠŸç‡: ${successfulPings.length}/${testCount} (${((successfulPings.length/testCount)*100).toFixed(1)}%)\n`;
      
      if (successfulPings.length > 0) {
        resultMessage += `å¹³å‡å»¶è¿Ÿ: ${avgLatency.toFixed(2)}ms\n`;
        resultMessage += `æœ€å°å»¶è¿Ÿ: ${minLatency.toFixed(2)}ms\n`;
        resultMessage += `æœ€å¤§å»¶è¿Ÿ: ${maxLatency.toFixed(2)}ms`;
      } else {
        resultMessage += `æ‰€æœ‰æµ‹è¯•å‡å¤±è´¥`;
      }
      
      setResult(resultMessage, successfulPings.length > 0 ? 'success' : 'error');
      
      // æ˜¾ç¤ºè¯¦ç»†è°ƒè¯•ä¿¡æ¯
      debugDiv.style.display = 'block';
      debugDiv.textContent = `Ping æµ‹è¯•è¯¦ç»†ç»“æœ:\n\n` + 
        pingResults.map(p => 
          `æµ‹è¯• ${p.attempt}: ${p.latency.toFixed(2)}ms - ${p.success ? 'æˆåŠŸ' : 'å¤±è´¥'} (${p.status})${p.error ? ` - ${p.error}` : ''}`
        ).join('\n') +
        `\n\nç»Ÿè®¡ä¿¡æ¯:\n` +
        `- æµ‹è¯•æ¬¡æ•°: ${testCount}\n` +
        `- æˆåŠŸæ¬¡æ•°: ${successfulPings.length}\n` +
        `- å¤±è´¥æ¬¡æ•°: ${testCount - successfulPings.length}\n` +
        `- æˆåŠŸç‡: ${((successfulPings.length/testCount)*100).toFixed(1)}%\n` +
        `- å¹³å‡å»¶è¿Ÿ: ${avgLatency.toFixed(2)}ms\n` +
        `- æœ€å°å»¶è¿Ÿ: ${minLatency.toFixed(2)}ms\n` +
        `- æœ€å¤§å»¶è¿Ÿ: ${maxLatency.toFixed(2)}ms\n` +
        `- å»¶è¿Ÿæ ‡å‡†å·®: ${successfulPings.length > 1 ? 
          Math.sqrt(successfulPings.reduce((sum, p) => sum + Math.pow(p.latency - avgLatency, 2), 0) / successfulPings.length).toFixed(2) : 
          '0.00'}ms`;
    });

    // æµ‹è¯•ä»…å›¾åƒç”ŸæˆæŒ‰é’®
    document.getElementById('testImageOnlyBtn').addEventListener('click', async () => {
      const apiKey = document.getElementById('apiKey').value.trim();
      const prompt = document.getElementById('prompt').value.trim();
      const aspectRatio = document.getElementById('aspectRatio').value;

      if (!apiKey || !prompt) {
        setResult('API Key å’Œæç¤ºè¯ä¸èƒ½ä¸ºç©º', 'error');
        return;
      }

      resetUI();
      setResult('æ­£åœ¨æµ‹è¯•ä»…å›¾åƒç”Ÿæˆ...', 'loading');

      const startTime = Date.now();

      const body = {
        contents: [
          {
            role: 'user',
            parts: [
              { text: prompt },
            ],
          },
        ],
        safetySettings: [
          { category: 'HARM_CATEGORY_HARASSMENT', threshold: 'BLOCK_NONE' },
          { category: 'HARM_CATEGORY_HATE_SPEECH', threshold: 'BLOCK_NONE' },
          { category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT', threshold: 'BLOCK_NONE' },
          { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', threshold: 'BLOCK_NONE' },
          { category: 'HARM_CATEGORY_CIVIC_INTEGRITY', threshold: 'BLOCK_NONE' },
        ],
        generationConfig: {
          responseModalities: ['IMAGE'], // å¼ºåˆ¶ä»…ç”Ÿæˆå›¾åƒ
        },
      };

      if (aspectRatio) {
        body.generationConfig.imageConfig = { aspectRatio };
      }

      console.log('ğŸš€ å¼€å§‹ä»…å›¾åƒç”Ÿæˆæµ‹è¯•:', {
        url: `${API_BASE}/${MODEL}:generateContent`,
        startTime: new Date().toLocaleTimeString(),
        body: JSON.stringify(body, null, 2)
      });

      try {
        const response = await fetch(`${API_BASE}/${MODEL}:generateContent`, {
          method: 'POST',
          headers: {
            'Authorization': buildAuthorizationHeader(apiKey),
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(body),
        });

        const rawText = await response.text();
        debugDiv.style.display = 'block';
        debugDiv.textContent = `HTTP ${response.status} ${response.statusText}\n\n${rawText}`;

        if (!response.ok) {
          setResult(`ä»…å›¾åƒç”Ÿæˆæµ‹è¯•å¤±è´¥ï¼šHTTP ${response.status}`, 'error');
          return;
        }

        const responseJson = JSON.parse(rawText);
        
        // è®°å½•APIå“åº”æ—¶é—´
        const apiResponseTime = Date.now();
        const apiDuration = apiResponseTime - startTime;
        console.log(`ğŸ“¡ ä»…å›¾åƒAPIå“åº”å®Œæˆï¼Œè€—æ—¶: ${(apiDuration / 1000).toFixed(2)}ç§’`);
        
        console.log('ä»…å›¾åƒç”Ÿæˆå“åº”:', responseJson);

        const candidate = responseJson?.candidates?.[0];
        const parts = candidate?.content?.parts || [];
        let imageData = null;

        parts.forEach((part, index) => {
          console.log(`ä»…å›¾åƒ Part ${index}:`, part);
          if (part.inlineData?.data) {
            imageData = part.inlineData.data;
            console.log('æ‰¾åˆ°å›¾åƒæ•°æ®ï¼Œé•¿åº¦:', imageData.length);
          }
        });

        if (imageData) {
          const endTime = Date.now();
          const totalTime = endTime - startTime;
          const timeSeconds = (totalTime / 1000).toFixed(2);
          
          setResult(`ä»…å›¾åƒç”Ÿæˆæµ‹è¯•æˆåŠŸï¼(è€—æ—¶: ${timeSeconds}ç§’)`, 'success');
          
          const cleanImageData = imageData.replace(/\s+/g, '');
          const img = document.createElement('img');
          img.src = `data:image/png;base64,${cleanImageData}`;
          img.alt = 'ç”Ÿæˆçš„å›¾åƒ';
          img.style.maxWidth = '100%';
          img.style.height = 'auto';
          img.style.borderRadius = '12px';
          img.style.border = '1px solid #e2e8f0';
          img.style.boxShadow = '0 8px 18px rgba(15, 23, 42, 0.12)';
          
          imagePreview.innerHTML = '';
          imagePreview.appendChild(img);
        } else {
          setResult('ä»…å›¾åƒç”Ÿæˆæµ‹è¯•å¤±è´¥ï¼šæœªè¿”å›å›¾åƒæ•°æ®', 'error');
          imagePreview.innerHTML = '<p style="color: red;">æœªè¿”å›å›¾åƒæ•°æ®</p>';
        }

      } catch (error) {
        const message = error instanceof Error ? error.message : String(error);
        setResult(`ä»…å›¾åƒç”Ÿæˆæµ‹è¯•å‡ºé”™ï¼š${message}`, 'error');
        debugDiv.style.display = 'block';
        debugDiv.textContent += `\n\nå¼‚å¸¸ä¿¡æ¯ï¼š${message}`;
      }
    });
  </script>
</body>
</html>
