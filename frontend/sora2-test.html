<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sora2 API æµ‹è¯•é¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 0;
            min-height: 600px;
        }

        .sidebar {
            background: #f8f9fa;
            border-right: 1px solid #e0e0e0;
            padding: 30px 20px;
            overflow-y: auto;
        }

        .main {
            padding: 30px;
            overflow-y: auto;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: #555;
            margin-bottom: 8px;
        }

        .form-group input[type="text"],
        .form-group input[type="password"],
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            font-family: 'Courier New', monospace;
            resize: none;
            transition: border-color 0.3s;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="password"]:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .checkbox-group:hover {
            background: #f0f0f0;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            flex: 1;
        }

        .stats {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 13px;
            border-bottom: 1px solid #f0f0f0;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #666;
        }

        .stat-value {
            font-weight: 600;
            color: #333;
            font-family: 'Courier New', monospace;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .status-idle {
            background: #ccc;
        }

        .status-loading {
            background: #ffa500;
            animation: pulse 1s infinite;
        }

        .status-ready {
            background: #4caf50;
        }

        .status-error {
            background: #f44336;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .button-group {
            display: grid;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            padding: 12px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            width: 100%;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #e0e0e0;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-section h3 {
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        textarea {
            min-height: 100px;
        }

        .output-section {
            margin-top: 30px;
        }

        .output-section h3 {
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
        }

        .response-container {
            background: #1e1e1e;
            color: #d4d4d4;
            border-radius: 6px;
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.5;
        }

        .response-container::-webkit-scrollbar {
            width: 8px;
        }

        .response-container::-webkit-scrollbar-track {
            background: #2d2d2d;
            border-radius: 4px;
        }

        .response-container::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }

        .response-container::-webkit-scrollbar-thumb:hover {
            background: #777;
        }

        .empty-state {
            color: #999;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
        }

        .message {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .message.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .message.info {
            background: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #2196f3;
        }

        .hint {
            font-size: 12px;
            color: #999;
            margin-top: 6px;
        }

        .api-info {
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            margin-top: 30px;
            font-size: 12px;
            color: #666;
        }

        .api-info h4 {
            margin-bottom: 10px;
            color: #333;
        }

        .api-info-item {
            margin: 8px 0;
            font-family: 'Courier New', monospace;
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }

            .sidebar {
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }

            .header h1 {
                font-size: 24px;
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid #667eea;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ¬ Sora2 API æµ‹è¯•é¡µé¢</h1>
            <p>Banana147 æ¨¡å‹ä¾›åº”å•† | OpenAI Chat Completions å…¼å®¹</p>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="section-title">âš™ï¸ é…ç½®</div>

                <!-- API Key -->
                <div class="form-group">
                    <label for="apiKey">API å¯†é’¥</label>
                    <input
                        type="password"
                        id="apiKey"
                        placeholder="sk-ERFNrFQL..."
                    >
                    <div id="keyStatus" style="margin-top: 8px; font-size: 12px; color: #4caf50;">âœ“ API Key å·²åŠ è½½</div>
                </div>

                <!-- Mode Selection -->
                <div class="form-group">
                    <label class="checkbox-group">
                        <input
                            type="checkbox"
                            id="streamMode"
                            checked
                        >
                        <label for="streamMode" style="margin: 0;">ä½¿ç”¨æµå¼æ¨¡å¼</label>
                    </label>
                    <div class="hint" id="modeHint">æµå¼æ¨¡å¼ï¼šå®æ—¶æ¥æ”¶å“åº”æ•°æ®</div>
                </div>

                <!-- Statistics -->
                <div class="stats">
                    <div class="stat-item">
                        <span class="stat-label">å“åº”é•¿åº¦</span>
                        <span class="stat-value" id="responseLength">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">çŠ¶æ€</span>
                        <span class="stat-value">
                            <span class="status-indicator status-idle" id="statusDot"></span>
                            <span id="statusText">å°±ç»ª</span>
                        </span>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="button-group">
                    <button class="btn-secondary" onclick="clearResponse()">æ¸…é™¤å“åº”</button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main">
                <!-- Input Section -->
                <div class="input-section">
                    <h3>ğŸ“ è¾“å…¥</h3>

                    <!-- Prompt -->
                    <div class="form-group">
                        <label for="prompt">è§†é¢‘æç¤ºè¯</label>
                        <textarea
                            id="prompt"
                            placeholder="ä¾‹å¦‚ï¼šä¸€åªç‹—åœ¨å…¬å›­é‡Œè·‘æ­¥ 16:9&#10;æˆ–ï¼šA dog running in the park 16:9"
                        ></textarea>
                        <div class="hint">åœ¨æç¤ºè¯æœ«å°¾æ·»åŠ å®½é«˜æ¯”ï¼š16:9ã€9:16ã€4:3 æˆ– æ¨ªå±ã€ç«–å±</div>
                    </div>

                    <!-- Image URL -->
                    <div class="form-group">
                        <label for="imageUrl">å‚è€ƒå›¾åƒ URLï¼ˆå¯é€‰ï¼‰</label>
                        <input
                            type="text"
                            id="imageUrl"
                            placeholder="https://example.com/image.jpg"
                        >
                        <div class="hint">æä¾›ä¸€ä¸ªå›¾åƒ URL ä½œä¸ºç”Ÿæˆå‚è€ƒ</div>
                    </div>

                    <!-- Generate Button -->
                    <button class="btn-primary" onclick="generateVideo()" id="generateBtn">
                        ğŸ¬ ç”Ÿæˆè§†é¢‘
                    </button>
                </div>

                <!-- Output Section -->
                <div class="output-section">
                    <h3>ğŸ“¤ å“åº”</h3>

                    <div id="messageContainer"></div>

                    <!-- Video Preview Section -->
                    <div id="videoSection" style="display: none; margin-bottom: 20px;">
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 6px;">
                            <h4 style="margin-bottom: 10px;">ğŸ¬ è§†é¢‘ä¿¡æ¯</h4>
                            <div id="videoInfo" style="font-size: 13px; color: #666; line-height: 1.6;"></div>
                            <button class="btn-primary" onclick="getVideoDownloadLink()" style="margin-top: 10px;">
                                â¬‡ï¸ è·å–è§†é¢‘ä¸‹è½½é“¾æ¥
                            </button>
                            <button class="btn-secondary" onclick="pollVideoStatus()" style="margin-top: 10px;">
                                ğŸ”„ æ£€æŸ¥è§†é¢‘ç”Ÿæˆè¿›åº¦
                            </button>
                        </div>
                    </div>

                    <div id="responseContainer" class="response-container">
                        <div class="empty-state">ğŸ“ æ— å“åº”</div>
                    </div>
                </div>

                <!-- API Info -->
                <div class="api-info">
                    <h4>ğŸ“¡ API ä¿¡æ¯</h4>
                    <div class="api-info-item"><strong>ç«¯ç‚¹ï¼š</strong> https://api1.147ai.com/v1/chat/completions</div>
                    <div class="api-info-item"><strong>æ¨¡å‹ï¼š</strong> sora-2-reverse</div>
                    <div class="api-info-item"><strong>è®¤è¯ï¼š</strong> Bearer Token (Authorization header)</div>
                    <div class="api-info-item"><strong>æ ¼å¼ï¼š</strong> OpenAI Chat Completions API å…¼å®¹</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ä» .env æ–‡ä»¶è¯»å–é…ç½®ï¼ˆéœ€è¦é€šè¿‡å¼€å‘æœåŠ¡å™¨ï¼‰
        // æˆ–ä½¿ç”¨ä»¥ä¸‹ç¡¬ç¼–ç å€¼
        const API_ENDPOINT = 'https://api1.147ai.com/v1/chat/completions';
        const MODEL = 'sora-2-reverse';
        const DEFAULT_API_KEY = 'sk-CHWofejyw9IsGbCmr6uyOrvmmCqFABBalq4jxv51cipZVShM';

        // DOM Elements
        const apiKeyInput = document.getElementById('apiKey');
        const promptInput = document.getElementById('prompt');
        const imageUrlInput = document.getElementById('imageUrl');
        const streamModeCheckbox = document.getElementById('streamMode');
        const generateBtn = document.getElementById('generateBtn');
        const responseContainer = document.getElementById('responseContainer');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const responseLengthSpan = document.getElementById('responseLength');
        const messageContainer = document.getElementById('messageContainer');
        const modeHint = document.getElementById('modeHint');

        let isGenerating = false;

        // Event Listeners
        streamModeCheckbox.addEventListener('change', () => {
            modeHint.textContent = streamModeCheckbox.checked
                ? 'æµå¼æ¨¡å¼ï¼šå®æ—¶æ¥æ”¶å“åº”æ•°æ®'
                : 'éæµå¼æ¨¡å¼ï¼šç­‰å¾…å®Œæ•´å“åº”';
        });

        // Generate Video
        async function generateVideo() {
            const apiKey = apiKeyInput.value.trim();
            const prompt = promptInput.value.trim();

            if (!apiKey) {
                showMessage('è¯·è¾“å…¥ API å¯†é’¥', 'error');
                return;
            }

            if (!apiKey.startsWith('sk-')) {
                showMessage('API å¯†é’¥æ ¼å¼ä¸æ­£ç¡®ï¼ˆåº”ä»¥ sk- å¼€å¤´ï¼‰', 'error');
                return;
            }

            if (!prompt) {
                showMessage('è¯·è¾“å…¥è§†é¢‘æç¤ºè¯', 'error');
                return;
            }

            isGenerating = true;
            generateBtn.disabled = true;
            clearMessages();
            clearResponse();
            updateStatus('loading', 'å¤„ç†ä¸­...');

            try {
                const useStream = streamModeCheckbox.checked;
                const result = await callSora2API(apiKey, prompt, imageUrlInput.value, useStream);

                if (result.success) {
                    showMessage('âœ“ è§†é¢‘ç”Ÿæˆå·²æäº¤ï¼', 'success');
                    updateStatus('ready', 'å°±ç»ª');

                    // Display video information if available
                    if (result.data) {
                        displayVideoInfo(result.data);
                    }
                } else {
                    showMessage(`é”™è¯¯: ${result.error}`, 'error');
                    updateStatus('error', 'é”™è¯¯');
                }
            } catch (error) {
                showMessage(`å¼‚å¸¸: ${error.message}`, 'error');
                updateStatus('error', 'é”™è¯¯');
                console.error('Generation error:', error);
            } finally {
                isGenerating = false;
                generateBtn.disabled = false;
            }
        }

        // Call Sora2 API
        async function callSora2API(apiKey, prompt, imageUrl, useStream) {
            const content = [
                {
                    type: 'text',
                    text: prompt
                }
            ];

            if (imageUrl) {
                content.push({
                    type: 'image_url',
                    image_url: { url: imageUrl }
                });
            }

            const request = {
                model: MODEL,
                stream: useStream,
                messages: [
                    {
                        role: 'user',
                        content: content
                    }
                ]
            };

            console.log('ğŸ¬ Sending request to Sora2 API...');
            console.log('Endpoint:', API_ENDPOINT);
            console.log('API Key:', apiKey.substring(0, 10) + '...');
            console.log('Prompt:', prompt);
            if (imageUrl) console.log('Image URL:', imageUrl);
            console.log('Request body:', JSON.stringify(request, null, 2));

            const response = await fetch(API_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify(request)
            });

            console.log('Response Status:', response.status);
            console.log('Response Headers:', response.headers);

            if (!response.ok) {
                let errorData = {};
                let errorText = '';
                try {
                    errorData = await response.json();
                    errorText = JSON.stringify(errorData, null, 2);
                } catch (e) {
                    errorText = await response.text();
                }
                console.error('Error Response Data:', errorData);
                console.error('Error Response Text:', errorText);

                // ä»ä¸åŒçš„å­—æ®µä¸­æå–é”™è¯¯ä¿¡æ¯
                const errorMessage =
                    errorData.message ||
                    errorData.error ||
                    errorData.error_description ||
                    errorData.detail ||
                    'API Error';

                throw new Error(`HTTP ${response.status}: ${errorMessage}\n${errorText}`);
            }

            if (useStream) {
                return await handleStreamResponse(response);
            } else {
                return await handleNonStreamResponse(response);
            }
        }

        // Handle Stream Response
        async function handleStreamResponse(response) {
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let fullContent = '';
            let buffer = '';

            try {
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');
                    buffer = lines.pop() || '';

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const jsonStr = line.slice(6);

                            if (jsonStr === '[DONE]') {
                                continue;
                            }

                            try {
                                const parsed = JSON.parse(jsonStr);
                                const content = parsed.choices[0]?.delta?.content || '';
                                if (content) {
                                    fullContent += content;
                                    updateResponse(fullContent);
                                }
                            } catch (e) {
                                console.debug('Failed to parse chunk:', jsonStr);
                            }
                        }
                    }
                }

                if (buffer && buffer.startsWith('data: ')) {
                    const jsonStr = buffer.slice(6);
                    if (jsonStr !== '[DONE]') {
                        try {
                            const parsed = JSON.parse(jsonStr);
                            const content = parsed.choices[0]?.delta?.content || '';
                            if (content) {
                                fullContent += content;
                                updateResponse(fullContent);
                            }
                        } catch (e) {
                            console.debug('Failed to parse final chunk:', jsonStr);
                        }
                    }
                }

                console.log('âœ… Stream completed. Total length:', fullContent.length);
                return { success: true, data: fullContent };
            } finally {
                reader.releaseLock();
            }
        }

        // Handle Non-Stream Response
        async function handleNonStreamResponse(response) {
            const data = await response.json();
            const content = data.choices[0]?.message?.content || '';
            updateResponse(content);
            console.log('âœ… Response received. Length:', content.length);
            return { success: true, data: content };
        }

        // Update Response Display
        function updateResponse(content) {
            if (content.length === 0) {
                responseContainer.innerHTML = '<div class="empty-state">ğŸ“ æ— å“åº”</div>';
            } else {
                responseContainer.textContent = content;
                responseContainer.scrollTop = responseContainer.scrollHeight;
            }
            responseLengthSpan.textContent = content.length;
        }

        // Clear Response
        function clearResponse() {
            updateResponse('');
            messageContainer.innerHTML = '';
            updateStatus('idle', 'å°±ç»ª');
        }

        // Show Message
        function showMessage(text, type = 'info') {
            const div = document.createElement('div');
            div.className = `message ${type}`;
            div.textContent = text;
            messageContainer.appendChild(div);

            if (type !== 'error') {
                setTimeout(() => div.remove(), 5000);
            }
        }

        // Clear Messages
        function clearMessages() {
            messageContainer.innerHTML = '';
        }

        // Update Status
        function updateStatus(status, text) {
            statusDot.className = `status-indicator status-${status}`;
            statusText.textContent = text;
        }

        // Store task ID globally
        let currentTaskId = null;
        let currentApiKey = null;

        // Extract and display video information
        function displayVideoInfo(responseData) {
            try {
                // Try to parse JSON from response
                let data = responseData;
                if (typeof responseData === 'string') {
                    // Extract JSON from the response text
                    const jsonMatch = responseData.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        data = JSON.parse(jsonMatch[0]);
                    }
                }

                if (data && data.task_id) {
                    currentTaskId = data.task_id;
                    currentApiKey = apiKeyInput.value;

                    let infoHtml = `
                        <div><strong>ä»»åŠ¡ ID:</strong> ${data.task_id}</div>
                        ${data.prompt ? `<div><strong>æç¤ºè¯:</strong> ${data.prompt}</div>` : ''}
                        ${data.orientation ? `<div><strong>æ–¹å‘:</strong> ${data.orientation}</div>` : ''}
                        ${data.duration ? `<div><strong>æ—¶é•¿:</strong> ${data.duration} ç§’</div>` : ''}
                        ${data.status ? `<div><strong>çŠ¶æ€:</strong> ${data.status}</div>` : ''}
                        ${data.progress ? `<div><strong>è¿›åº¦:</strong> ${data.progress}%</div>` : ''}
                    `;

                    document.getElementById('videoInfo').innerHTML = infoHtml;
                    document.getElementById('videoSection').style.display = 'block';
                    showMessage('âœ“ å·²è·å–è§†é¢‘ä¿¡æ¯ï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–ä¸‹è½½é“¾æ¥æˆ–æ£€æŸ¥ç”Ÿæˆè¿›åº¦', 'success');
                }
            } catch (error) {
                console.error('Error parsing video info:', error);
            }
        }

        // Poll video status
        async function pollVideoStatus() {
            if (!currentTaskId) {
                showMessage('è¯·å…ˆç”Ÿæˆè§†é¢‘', 'error');
                return;
            }

            try {
                const statusResponse = await fetch(`https://api1.147ai.com/v1/tasks/${currentTaskId}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${currentApiKey}`
                    }
                });

                if (!statusResponse.ok) {
                    throw new Error(`HTTP ${statusResponse.status}`);
                }

                const statusData = await statusResponse.json();
                console.log('Video status:', statusData);

                let statusMsg = `çŠ¶æ€: ${statusData.status || 'æœªçŸ¥'}\n`;
                if (statusData.progress) statusMsg += `è¿›åº¦: ${statusData.progress}%\n`;
                if (statusData.video_url) {
                    statusMsg += `è§†é¢‘ URL: ${statusData.video_url}\n`;
                    showMessage(`âœ“ è§†é¢‘å·²ç”Ÿæˆï¼ç‚¹å‡»ä¸‹æ–¹é“¾æ¥ä¸‹è½½: ${statusData.video_url}`, 'success');
                } else {
                    showMessage(statusMsg, 'info');
                }

                updateResponse(statusMsg + '\n\n' + JSON.stringify(statusData, null, 2));
            } catch (error) {
                showMessage(`è·å–è¿›åº¦å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // Get video download link
        async function getVideoDownloadLink() {
            if (!currentTaskId) {
                showMessage('è¯·å…ˆç”Ÿæˆè§†é¢‘', 'error');
                return;
            }

            try {
                const downloadResponse = await fetch(`https://api1.147ai.com/v1/tasks/${currentTaskId}/download`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${currentApiKey}`
                    }
                });

                if (!downloadResponse.ok) {
                    // Try alternative endpoint
                    const altResponse = await fetch(`https://api1.147ai.com/v1/videos/${currentTaskId}`, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${currentApiKey}`
                        }
                    });

                    if (!altResponse.ok) {
                        throw new Error(`HTTP ${altResponse.status}`);
                    }

                    const videoData = await altResponse.json();
                    console.log('Video data:', videoData);

                    if (videoData.video_url) {
                        showMessage(`âœ“ è§†é¢‘ä¸‹è½½é“¾æ¥å·²è·å–ï¼`, 'success');
                        updateResponse(`è§†é¢‘ä¸‹è½½é“¾æ¥:\n${videoData.video_url}\n\nå®Œæ•´å“åº”:\n${JSON.stringify(videoData, null, 2)}`);
                    }
                } else {
                    const downloadData = await downloadResponse.json();
                    console.log('Download link:', downloadData);

                    if (downloadData.video_url) {
                        showMessage(`âœ“ è§†é¢‘ä¸‹è½½é“¾æ¥å·²è·å–ï¼`, 'success');
                        updateResponse(`è§†é¢‘ä¸‹è½½é“¾æ¥:\n${downloadData.video_url}\n\nå®Œæ•´å“åº”:\n${JSON.stringify(downloadData, null, 2)}`);
                    }
                }
            } catch (error) {
                showMessage(`è·å–ä¸‹è½½é“¾æ¥å¤±è´¥: ${error.message}ã€‚å¯èƒ½è§†é¢‘è¿˜åœ¨ç”Ÿæˆä¸­ï¼Œè¯·ç¨åé‡è¯•`, 'error');
                console.error('Download link error:', error);
            }
        }

        // Initialize
        console.log('ğŸš€ Sora2 API Test Page loaded');
        console.log('API Endpoint:', API_ENDPOINT);
        console.log('Model:', MODEL);

        // ä»ç¯å¢ƒå˜é‡æˆ–ä½¿ç”¨é»˜è®¤å€¼åˆå§‹åŒ–
        apiKeyInput.value = DEFAULT_API_KEY;
        apiKeyInput.addEventListener('input', () => {
            if (apiKeyInput.value.trim()) {
                document.getElementById('keyStatus').textContent = 'âœ“ API Key å·²åŠ è½½';
                document.getElementById('keyStatus').style.color = '#4caf50';
            } else {
                document.getElementById('keyStatus').textContent = 'âš ï¸ è¯·è¾“å…¥ API Key';
                document.getElementById('keyStatus').style.color = '#ff9800';
            }
        });
    </script>
</body>
</html>
