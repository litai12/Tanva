# ğŸŒ OSS + CDN å®Œæ•´æŒ‡å—

## å¿«é€Ÿå›ç­”: OSS+CDNæ˜¯ä»€ä¹ˆï¼Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä½ çš„åº”ç”¨æ¶æ„                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡    åŠ¨æ€å†…å®¹(HTML/JS/CSS)                          â”‚
â”‚       â†“                  â†“                                       â”‚
â”‚     [OSS]  â†â†’        [Web Server]  â† ä½ çš„ä»£ç è¿è¡Œåœ¨è¿™é‡Œ        â”‚
â”‚  (å­˜å‚¨ âš¡) â”‚            (ECS)                                   â”‚
â”‚            â”‚                                                   â”‚
â”‚            â””â”€â†’ [CDN]  â†  ç”¨æˆ·è®¿é—®è¿™é‡Œ (å…¨çƒç¼“å­˜)                 â”‚
â”‚             (åŠ é€Ÿ ğŸš€)                                            â”‚
â”‚                                                                 â”‚
â”‚  ç»“æœ: ç”¨æˆ·å¾—åˆ°è¶…å¿«çš„è®¿é—®é€Ÿåº¦ âœ¨                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä»€ä¹ˆæ˜¯ OSS?

**OSS = Object Storage Service (å¯¹è±¡å­˜å‚¨æœåŠ¡)**

### ç®€å•ç±»æ¯”
```
ä¼ ç»Ÿç¡¬ç›˜:              OSS (é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨):
C:\Users\litai\       https://bucket.oss-cn-shenzhen.aliyuncs.com/
â”œâ”€â”€ folder1/          â”œâ”€â”€ projects/
â”‚   â””â”€â”€ photo.jpg     â”‚   â””â”€â”€ user-001/
â”‚   â””â”€â”€ photo2.jpg    â”‚       â””â”€â”€ project-abc/
â”‚   â””â”€â”€ video.mp4     â”‚           â””â”€â”€ image1.jpg
â”œâ”€â”€ folder2/          â””â”€â”€ temp/
â”‚   â””â”€â”€ data.csv          â””â”€â”€ upload-temp/
â””â”€â”€ config.ini            â””â”€â”€ file.tmp

æœ¬åœ°å­˜å‚¨                   äº‘å­˜å‚¨ (æ— é™æ‰©å±•)
```

### OSS çš„æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ | ä½ çš„ç”¨é€” |
|------|------|---------|
| **æ— é™å­˜å‚¨** | éœ€è¦å¤šå°‘å°±èƒ½å­˜å¤šå°‘ | AIç”Ÿæˆçš„å›¾åƒæ— é™ä¿å­˜ |
| **æŒ‰é‡ä»˜è´¹** | åªæŒ‰å®é™…ä½¿ç”¨é‡è®¡è´¹ | 500GB = Â¥25/æœˆ |
| **å¯é æ€§** | 99.9999999999% å¯ç”¨æ€§ (12ä¸ª9) | ç”¨æˆ·å›¾ç‰‡æ°¸è¿œä¸¢ä¸äº† |
| **è®¿é—®é€Ÿåº¦** | åœ°åŸŸå°±è¿‘è®¿é—® | å›½å†…ç”¨æˆ·ç§’é€Ÿè®¿é—® |
| **ç‰ˆæœ¬æ§åˆ¶** | è‡ªåŠ¨ä¿å­˜æ–‡ä»¶ç‰ˆæœ¬ | å¯æ¢å¤æ—§ç‰ˆæœ¬å›¾åƒ |
| **æƒé™æ§åˆ¶** | ç²¾ç»†è®¿é—®æƒé™ç®¡ç† | åªæœ‰ç”¨æˆ·è‡ªå·±èƒ½çœ‹è‡ªå·±çš„å›¾åƒ |

### åœ¨Tanvaä¸­çš„åº”ç”¨

```typescript
// ç”¨æˆ·ç”Ÿæˆäº†ä¸€å¼ å›¾åƒ
const generatedImage = await aiService.generateImage("ç¾ä¸½çš„æ—¥è½");

// åç«¯è‡ªåŠ¨ä¸Šä¼ åˆ°OSS
const ossUrl = await ossService.upload(generatedImage, {
  bucket: 'tai-tanva-ai',
  key: `projects/${userId}/${projectId}/images/${timestamp}_${filename}`,
  contentType: 'image/png'
});

// è¿”å›ç»™å‰ç«¯çš„æ˜¯OSS URLï¼Œä¸æ˜¯æœ¬åœ°è·¯å¾„
{
  "url": "https://tai-tanva-ai.oss-cn-shenzhen.aliyuncs.com/projects/user-001/proj-abc/images/1761192577837_k3dpq7.png",
  "thumbnailUrl": "https://tai-tanva-ai.oss-cn-shenzhen.aliyuncs.com/projects/user-001/proj-abc/images/1761192577837_k3dpq7.png?x-oss-process=image/resize,w_200,h_200"
}
```

---

## ä»€ä¹ˆæ˜¯ CDN?

**CDN = Content Delivery Network (å†…å®¹åˆ†å‘ç½‘ç»œ)**

### ç®€å•ç±»æ¯”

```
âŒ æ²¡æœ‰CDNçš„æƒ…å†µ:
ç”¨æˆ·1(åŒ—äº¬) â”€â”€\
ç”¨æˆ·2(ä¸Šæµ·)   â”œâ”€â”€â†’ [æœåŠ¡å™¨åœ¨æ·±åœ³]  â”€â†’ ç½‘ç»œæ‹¥å µï¼Œé€Ÿåº¦æ…¢
ç”¨æˆ·3(å¹¿å·) â”€â”€/
è·ç¦»è¿œï¼Œè·¯ç”±å¤æ‚ï¼Œå»¶è¿Ÿé«˜ â±ï¸

âœ… æœ‰CDNçš„æƒ…å†µ:
ç”¨æˆ·1(åŒ—äº¬) â†’ [åŒ—äº¬CDNèŠ‚ç‚¹] â”€â”
ç”¨æˆ·2(ä¸Šæµ·) â†’ [ä¸Šæµ·CDNèŠ‚ç‚¹] â”€â”¼â†’ [æºæœåŠ¡å™¨] â”€â”
ç”¨æˆ·3(å¹¿å·) â†’ [å¹¿å·CDNèŠ‚ç‚¹] â”€â”˜                â”œâ†’ æ•°æ®åŒæ­¥
                                     â”Œâ”€â”€â”€â”€â”€â”€â†’ [æ—¥æœ¬CDNèŠ‚ç‚¹]
                                     â””â”€â”€â”€â”€â”€â”€â†’ [æ–°åŠ å¡CDNèŠ‚ç‚¹]

æœ€è¿‘çš„èŠ‚ç‚¹, æœ¬åœ°ç¼“å­˜, ç§’é€Ÿè®¿é—® ğŸš€
```

### CDN çš„æ ¸å¿ƒåŸç†

1. **è¾¹ç•ŒèŠ‚ç‚¹** - åœ¨å…¨å›½å„åœ°éƒ¨ç½²æœåŠ¡å™¨
2. **æ™ºèƒ½è·¯ç”±** - ç”¨æˆ·è‡ªåŠ¨è¿æ¥æœ€è¿‘çš„èŠ‚ç‚¹
3. **å†…å®¹ç¼“å­˜** - çƒ­é—¨å†…å®¹ç¼“å­˜åœ¨å„ä¸ªèŠ‚ç‚¹
4. **è‡ªåŠ¨æ›´æ–°** - æºç«™æ›´æ–°æ—¶è‡ªåŠ¨æ¨é€åˆ°å„èŠ‚ç‚¹

### æ€§èƒ½å¯¹æ¯”

```
åœºæ™¯ï¼šç”¨æˆ·ä»ä¸Šæµ·è®¿é—®æœåŠ¡å™¨åœ¨æ·±åœ³çš„å›¾åƒ

âŒ ç›´è¿ECSæœåŠ¡å™¨:
å»¶è¿Ÿ: 20-50ms
å¸¦å®½: 10Mbps (å—é™)
æ—¶é—´: ä¸‹è½½ 5MB å›¾åƒ = 4ç§’

âœ… é€šè¿‡CDNåŠ é€Ÿ:
å»¶è¿Ÿ: 2-10ms (æœ¬åœ°ç¼“å­˜)
å¸¦å®½: 100Mbps+ (é¢„ç•™æ›´å¤š)
æ—¶é—´: ä¸‹è½½ 5MB å›¾åƒ = 0.4ç§’
æ•ˆæœ: å¿«10å€ ğŸš€
```

---

## OSS + CDN çš„é…åˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å·¥ä½œæµç¨‹                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ ä¸Šä¼ é˜¶æ®µ (ç”¨æˆ·ç”Ÿæˆå›¾åƒ)
   ç”¨æˆ·è¯·æ±‚ â†’ åç«¯è°ƒç”¨AI â†’ ç”Ÿæˆå›¾åƒ â†’ ä¸Šä¼ åˆ° OSS

2ï¸âƒ£ ç¼“å­˜é˜¶æ®µ (CDNåŠ é€Ÿ)
   OSS â”€â”€â†’ CDNåŠ é€Ÿ â”€â”€â†’ å…¨å›½å„åœ°ç¼“å­˜ (è‡ªåŠ¨å®Œæˆ)

3ï¸âƒ£ è®¿é—®é˜¶æ®µ (ç”¨æˆ·æŸ¥çœ‹)
   ç”¨æˆ· â†’ è¿æ¥æœ€è¿‘çš„CDNèŠ‚ç‚¹ â†’ ç§’é€ŸåŠ è½½ âœ¨

ç¤ºä¾‹ URL:
https://tai-tanva-ai.oss-cn-shenzhen.aliyuncs.com/projects/user-001/image.jpg
     â†‘                  â†‘
  è‡ªå®šä¹‰åŸŸå           é˜¿é‡Œäº‘OSSæœåŠ¡


åŠ é€Ÿåçš„ URL:
https://image.tai-tanva-ai.com/projects/user-001/image.jpg
     â†‘                          â†‘
  CDNåŠ é€ŸåŸŸå (é…ç½®CNAME)      è‡ªåŠ¨è·¯ç”±åˆ°æœ€è¿‘èŠ‚ç‚¹
```

---

## åœ¨Tanvaä¸­å¦‚ä½•ä½¿ç”¨ OSS+CDN?

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Tanva AI åº”ç”¨çš„å®Œæ•´æ¶æ„                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·è®¿é—® â†’ Nginxåå‘ä»£ç† â† è¾¹ç•ŒèŠ‚ç‚¹ (CDN)
              â†“
          [WebæœåŠ¡å™¨]
          (ECS + Node.js)
         è¿è¡Œä½ çš„åº”ç”¨ä»£ç 
              â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â†“                   â†“
[æ•°æ®åº“]              [OSSå­˜å‚¨]
(RDS)              (å›¾åƒ/æ–‡ä»¶)
   â†“                   â†“
ç”¨æˆ·æ•°æ®              é™æ€å†…å®¹
                  (ç”±CDNåŠ é€Ÿ)
```

### å…·ä½“æµç¨‹

#### ç¬¬1æ­¥: ç”¨æˆ·ç”Ÿæˆå›¾åƒ

```typescript
// å‰ç«¯è¯·æ±‚
POST /api/ai/generate-image
{
  "prompt": "ç¾ä¸½çš„æ—¥è½"
}

// åç«¯å¤„ç†
1. è°ƒç”¨Gemini APIç”Ÿæˆå›¾åƒ
2. è·å¾—å›¾åƒ Buffer
3. ä¸Šä¼ åˆ°OSS (å…³é”®æ­¥éª¤!)
4. è¿”å›OSS URLç»™å‰ç«¯

// å“åº”ç¤ºä¾‹ï¼ˆä¸å†è¿”å› base64ï¼‰
{
  "imageUrl": "https://<cdn-or-oss-host>/uploads/ai/generated/<hash>/<timestamp>-<rand>.png",
  "textResponse": "ï¼ˆå¯é€‰ï¼‰",
  "metadata": {
    "imageKey": "uploads/ai/generated/<hash>/<timestamp>-<rand>.png",
    "mimeType": "image/png"
  }
}
```

#### ç¬¬2æ­¥: ä¸Šä¼ åˆ°OSS

```typescript
// server/src/oss/oss.service.ts

async uploadImage(
  imageBuffer: Buffer,
  options: {
    userId: string;
    projectId: string;
    filename: string;
  }
): Promise<string> {
  const ossClient = new OSS({
    region: 'oss-cn-shenzhen',
    accessKeyId: process.env.ALIYUN_ACCESS_KEY,
    accessKeySecret: process.env.ALIYUN_SECRET_KEY,
    bucket: 'tai-tanva-ai',
  });

  const key = `projects/${options.userId}/${options.projectId}/images/${Date.now()}_${options.filename}`;

  // ä¸Šä¼ åˆ°OSS
  const result = await ossClient.put(key, imageBuffer, {
    headers: {
      'Content-Type': 'image/png',
      'x-oss-object-acl': 'public-read',  // å…¬å¼€è®¿é—®
    }
  });

  // è¿”å›CDNåŠ é€Ÿçš„URL (éœ€è¦é…ç½®CNAME)
  return `https://image.tai-tanva-ai.com/projects/${options.userId}/${options.projectId}/images/${Date.now()}_${options.filename}`;
}
```

#### ç¬¬3æ­¥: CDNåŠ é€Ÿé…ç½®

```
1. åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°é…ç½®CDNåŠ é€Ÿ
   â”œâ”€ æºç«™: tai-tanva-ai.oss-cn-shenzhen.aliyuncs.com
   â”œâ”€ CDNåŸŸå: image.tai-tanva-ai.com
   â”œâ”€ CNAME: image.tai-tanva-ai.com.w.alikunlun.com
   â””â”€ ç¼“å­˜ç­–ç•¥:
       â”œâ”€ *.jpg: 30å¤©
       â”œâ”€ *.png: 30å¤©
       â””â”€ å…¶ä»–: æ ¹æ®æ–‡ä»¶ç±»å‹

2. åœ¨åŸŸåæä¾›å•†é…ç½®DNS
   image.tai-tanva-ai.com CNAME image.tai-tanva-ai.com.w.alikunlun.com

3. ç­‰å¾…DNSç”Ÿæ•ˆ (é€šå¸¸5åˆ†é’Ÿ)

4. éªŒè¯
   curl -I https://image.tai-tanva-ai.com/projects/user-001/image.jpg
   å“åº”å¤´åº”è¯¥çœ‹åˆ°: x-cache: HIT (è¡¨ç¤ºå‘½ä¸­ç¼“å­˜)
```

---

## æˆæœ¬åˆ†æ

### OSS å­˜å‚¨æˆæœ¬

```
é˜¿é‡Œäº‘OSSå®šä»· (å›½å†…):

å®¹é‡        ä»·æ ¼        å¹´è´¹
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
100GB      Â¥5          Â¥60
500GB      Â¥25         Â¥300
1TB        Â¥50         Â¥600
5TB        Â¥250        Â¥3000

ä½ çš„ç”¨é€”ä¼°ç®—:
- å‡è®¾æ¯ä¸ªAIç”Ÿæˆçš„å›¾åƒ = 2MB
- æ¯å¤©æ–°å¢ 100 å¼ å›¾åƒ = 200MB
- æ¯æœˆæ–°å¢ 6GB
- 1å¹´æ–°å¢ 72GB

æ¨è: 100GBå¥—é¤ = Â¥5/æœˆ
```

### CDN æµé‡æˆæœ¬

```
é˜¿é‡Œäº‘CDNå®šä»· (å›½å†…):

æµé‡          ä»·æ ¼
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0-10GB/å¤©    Â¥0.21/GB
10-50GB/å¤©   Â¥0.16/GB
50GB+/å¤©     Â¥0.12/GB

å¹´åº¦æˆæœ¬ä¼°ç®—:
- å‡è®¾æœˆå‡ä¸‹è½½ 500GB
- 500GB Ã— Â¥0.21 = Â¥105
- å¹´è´¹: Â¥105 Ã— 12 = Â¥1260

å¦‚æœç”¨æˆ·å¤šï¼Œæµé‡å¤§:
- 1TB/æœˆ = å¹´è´¹ Â¥2000-3000
```

### æ€»æˆæœ¬

```
æœåŠ¡              æœˆè´¹
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ECSæœåŠ¡å™¨        Â¥50-100
RDSæ•°æ®åº“        Â¥30-50
OSSå­˜å‚¨          Â¥5-20
CDNåŠ é€Ÿ          Â¥100-200
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡              Â¥185-370/æœˆ

æˆæœ¬ä¼˜åŒ–å»ºè®®:
âœ… ä½¿ç”¨å…±äº«å‹ECSé™ä½æˆæœ¬
âœ… å¯ç”¨CDNç¼“å­˜ (1ä¸ªæœˆç¼“å­˜æœŸ = å‡å°‘90%æµé‡)
âœ… æŒ‰éœ€ä»˜è´¹è€Œéå›ºå®šå¥—é¤
```

---

## ä»€ä¹ˆæ—¶å€™éœ€è¦ CDN?

### ä¸éœ€è¦CDNçš„æƒ…å†µ âŒ
```
- ç”¨æˆ·åªåœ¨å…¬å¸å†…ç½‘è®¿é—®
- ç”¨æˆ·éƒ½é›†ä¸­åœ¨åŒä¸€åœ°åŒº
- æ—¥å‡è®¿é—®é‡ < 1000 æ¬¡
- å¯¹é€Ÿåº¦æ²¡æœ‰ç‰¹æ®Šè¦æ±‚
â†’ ç›´æ¥ç”¨ECS + OSSè¶³å¤Ÿ
```

### éœ€è¦CDNçš„æƒ…å†µ âœ…
```
- ç”¨æˆ·åˆ†å¸ƒå…¨å›½å„åœ°
- ç”¨æˆ·åœ¨å›½å¤–
- æ—¥å‡è®¿é—®é‡ > 10000 æ¬¡
- å›¾åƒåŠ è½½é€Ÿåº¦å½±å“ç”¨æˆ·ä½“éªŒ
- éœ€è¦ç§’é€ŸåŠ è½½ (åšäº§å“æ¼”ç¤º/å®¢æˆ·å±•ç¤º)
â†’ å¿…é¡»é…ç½®CDN
```

### Tanvaçš„æ¨èæ–¹æ¡ˆ

```
é˜¶æ®µ1: åˆæœŸç‰ˆæœ¬ (MVP)
â””â”€ ECS + OSS
   æˆæœ¬: Â¥80-150/æœˆ
   é€‚åˆ: å°å›¢é˜Ÿã€å†…éƒ¨ä½¿ç”¨

é˜¶æ®µ2: å…¬å¼€beta
â””â”€ ECS + OSS + CDN (å›½å†…)
   æˆæœ¬: Â¥200-350/æœˆ
   é€‚åˆ: å…¬å¼€æµ‹è¯•ã€åŒºåŸŸç”¨æˆ·

é˜¶æ®µ3: æ­£å¼ä¸Šçº¿
â””â”€ ECS + OSS + CDN (å›½å†…+å›½é™…) + å¤šåœ°åŸŸ
   æˆæœ¬: Â¥500-1000/æœˆ
   é€‚åˆ: å•†ä¸šäº§å“ã€å…¨çƒç”¨æˆ·
```

---

## é…ç½®æ­¥éª¤ (å®Œæ•´æ¸…å•)

### é˜¶æ®µA: é…ç½®OSS (1å°æ—¶)

```bash
# 1. åˆ›å»ºOSS bucket
åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°:
â”œâ”€ Bucketåç§°: tai-tanva-ai
â”œâ”€ åœ°åŸŸ: åå— (æ·±åœ³)
â”œâ”€ å­˜å‚¨ç±»å‹: æ ‡å‡†å­˜å‚¨
â”œâ”€ è¯»å†™æƒé™: å…¬å¼€è¯»
â””â”€ æœåŠ¡ç«¯åŠ å¯†: å¯ç”¨

# 2. åˆ›å»ºIAMç”¨æˆ· (ç”¨äºåç«¯API)
â”œâ”€ ç”¨æˆ·å: tanva-oss-service
â”œâ”€ æƒé™: AliyunOSSFullAccess
â”œâ”€ è·å¾— AccessKeyId å’Œ AccessKeySecret

# 3. åœ¨åç«¯é…ç½®ç¯å¢ƒå˜é‡
ALIYUN_ACCESS_KEY=xxxxxxxx
ALIYUN_SECRET_KEY=xxxxxxxx
ALIYUN_OSS_REGION=oss-cn-shenzhen
ALIYUN_OSS_BUCKET=tai-tanva-ai
```

### é˜¶æ®µB: é›†æˆOSS SDK (2å°æ—¶)

```bash
# 1. å®‰è£…é˜¿é‡Œäº‘OSS SDK
npm install ali-oss

# 2. åˆ›å»ºOSSæœåŠ¡
src/oss/oss.service.ts

# 3. ä¿®æ”¹AIç”Ÿæˆå™¨é›†æˆOSSä¸Šä¼ 
src/ai/image-generation.service.ts

# 4. æµ‹è¯•ä¸Šä¼ å’Œè®¿é—®
curl https://tai-tanva-ai.oss-cn-shenzhen.aliyuncs.com/test-image.jpg
```

### é˜¶æ®µC: é…ç½®CDN (30åˆ†é’Ÿ)

```bash
# 1. åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°åˆ›å»ºCDNåŠ é€ŸåŸŸå
â”œâ”€ åŠ é€ŸåŸŸå: image.tai-tanva-ai.com
â”œâ”€ ä¸šåŠ¡ç±»å‹: å›¾åƒå°æ–‡ä»¶
â”œâ”€ æºç«™ç±»å‹: OSSæºç«™
â”œâ”€ æºç«™åŸŸå: tai-tanva-ai.oss-cn-shenzhen.aliyuncs.com
â””â”€ å¯ç”¨HTTPS

# 2. æ›´æ–°DNSè®°å½• (åœ¨åŸŸåæä¾›å•†)
image.tai-tanva-ai.com CNAME image.tai-tanva-ai.com.w.alikunlun.com

# 3. éªŒè¯é…ç½®
curl -I https://image.tai-tanva-ai.com/test-image.jpg
# æŸ¥çœ‹å“åº”å¤´ä¸­çš„ x-cache å­—æ®µ
# HIT = å‘½ä¸­ç¼“å­˜ âœ…
# MISS = æœªå‘½ä¸­ç¼“å­˜ (é¦–æ¬¡è®¿é—®æ­£å¸¸)
```

### é˜¶æ®µD: æ›´æ–°åº”ç”¨ä»£ç 

```typescript
// ä¿®æ”¹ç¯å¢ƒé…ç½®
.env.production æ·»åŠ :
OSS_REGION=oss-cn-shenzhen
OSS_BUCKET=tai-tanva-ai
CDN_DOMAIN=https://image.tai-tanva-ai.com

// ä¿®æ”¹è¿”å›URLé€»è¾‘
if (process.env.NODE_ENV === 'production') {
  return `${process.env.CDN_DOMAIN}/projects/${userId}/${projectId}/image.jpg`;
} else {
  return `https://tai-tanva-ai.oss-cn-shenzhen.aliyuncs.com/projects/${userId}/${projectId}/image.jpg`;
}
```

---

## ç›‘æ§å’Œç»´æŠ¤

### å…³é”®æŒ‡æ ‡

```
å®šæœŸæ£€æŸ¥:
â–¡ OSSå­˜å‚¨å®¹é‡ä½¿ç”¨ç‡
â–¡ CDNç¼“å­˜å‘½ä¸­ç‡ (ç›®æ ‡: > 80%)
â–¡ CDNå¹³å‡è®¿é—®å»¶è¿Ÿ (ç›®æ ‡: < 100ms)
â–¡ æ¯æœˆæµé‡æˆæœ¬

ä¼˜åŒ–å»ºè®®:
â–¡ å®šæœŸæ¸…ç†è¿‡æœŸå›¾åƒ (å‡å°‘å­˜å‚¨æˆæœ¬)
â–¡ è°ƒæ•´CDNç¼“å­˜æ—¶é—´ (çƒ­é—¨å†…å®¹ç¼“å­˜æ›´é•¿)
â–¡ å¯ç”¨å›¾åƒå‹ç¼© (å‡å°‘å¸¦å®½æˆæœ¬)
â–¡ ç›‘æ§æµé‡å¼‚å¸¸ (é˜²æ­¢DDoS)
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹OSSè®¿é—®æ—¥å¿—
é˜¿é‡Œäº‘æ§åˆ¶å° â†’ OSS â†’ æ—¥å¿—åˆ†æ

# æŸ¥çœ‹CDNæ€§èƒ½æ•°æ®
é˜¿é‡Œäº‘æ§åˆ¶å° â†’ CDN â†’ æ•°æ®åˆ†æ

# æŸ¥çœ‹æˆæœ¬åˆ†æ
é˜¿é‡Œäº‘æ§åˆ¶å° â†’ è´¹ç”¨ä¸­å¿ƒ â†’ è´¦å•ç®¡ç†
```

---

## å¯¹æ¯”: ä¸åŒå­˜å‚¨æ–¹æ¡ˆ

```
æ–¹æ¡ˆ            æˆæœ¬      é€Ÿåº¦      å¯é æ€§    æ‰©å±•æ€§
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æœ¬åœ°ECSç¡¬ç›˜    æœ€ä¾¿å®œ    å¿«        ä¸€èˆ¬      å·®âŒ
NFSç½‘ç»œå­˜å‚¨    ä¸­ç­‰      ä¸­ç­‰      å¥½        ä¸­ç­‰
OSS            ä¾¿å®œ      å¿«        ä¼˜ç§€      ä¼˜ç§€âœ…
OSS+CDN        è¾ƒè´µ      ä¼˜ç§€      ä¼˜ç§€      ä¼˜ç§€âœ…
å¤šäº‘å¤šåœ°åŸŸ      æ˜‚è´µ      æœ€å¿«      æœ€å¥½      æœ€å¥½ğŸš€
```

---

## æ€»ç»“

### ä¸ºä»€ä¹ˆTanvaéœ€è¦ OSS + CDN?

```
âœ… æ— é™å­˜å‚¨ç©ºé—´
   - AIç”Ÿæˆçš„å›¾åƒå¯ä»¥æ— é™ä¿å­˜

âœ… ç”¨æˆ·æ•°æ®å®‰å…¨
   - ä¸“ä¸šçº§å®¹ç¾å¤‡ä»½
   - 99.9999999999% å¯ç”¨æ€§

âœ… è¶…å¿«è®¿é—®é€Ÿåº¦
   - ç”¨æˆ·ç§’é€ŸåŠ è½½å›¾åƒ
   - å…¨å›½å°±è¿‘è®¿é—®

âœ… è‡ªåŠ¨æ‰©å±•
   - ç”¨æˆ·å¢å¤šï¼Œç³»ç»Ÿè‡ªåŠ¨æ‰©å±•
   - æ— éœ€æ‹…å¿ƒå®¹é‡é—®é¢˜

âœ… æˆæœ¬æ•ˆç›Š
   - æŒ‰ä½¿ç”¨é‡ä»˜è´¹
   - çœå»è¿ç»´å¤æ‚åº¦
```

### å®æ–½è·¯çº¿å›¾

```
ç¬¬1å‘¨: é…ç½®OSS
â”œâ”€ åˆ›å»ºbucket
â”œâ”€ ç”Ÿæˆè®¿é—®å¯†é’¥
â””â”€ åç«¯é›†æˆ (3-4å°æ—¶)

ç¬¬2å‘¨: ä¸Šçº¿å‰ä¼˜åŒ–
â”œâ”€ é…ç½®CDNåŠ é€Ÿ
â”œâ”€ ä¿®æ”¹URLè¿”å›é€»è¾‘
â””â”€ æ€§èƒ½æµ‹è¯•

ç¬¬3å‘¨: ç›‘æ§å’Œä¼˜åŒ–
â”œâ”€ æŸ¥çœ‹æˆæœ¬æ•°æ®
â”œâ”€ ä¼˜åŒ–ç¼“å­˜ç­–ç•¥
â””â”€ æŒç»­ç›‘æ§è´¨é‡æŒ‡æ ‡
```

---

## ä¸‹ä¸€æ­¥

ç°åœ¨ä½ å·²ç»ç†è§£äº†OSS+CDNçš„æ¦‚å¿µï¼Œå¯ä»¥:

1. **é˜…è¯»éƒ¨ç½²æŒ‡å—**: æŸ¥çœ‹ `ALIYUN_DEPLOYMENT_GUIDE.md`
2. **é…ç½®OSS**: æŒ‰ç…§ä¸Šè¿°æ­¥éª¤åœ¨é˜¿é‡Œäº‘åˆ›å»ºbucket
3. **é›†æˆä»£ç **: æ·»åŠ OSSä¸Šä¼ é€»è¾‘åˆ°åç«¯
4. **æµ‹è¯•CDN**: é…ç½®CDNåŠ é€Ÿå¹¶éªŒè¯æ€§èƒ½

æ¨èé¡ºåº:
```
OSSé…ç½® â†’ åç«¯é›†æˆ â†’ CDNé…ç½® â†’ æ€§èƒ½æµ‹è¯• â†’ ä¸Šçº¿
  1h       2h        1h        1h       âœ…
```

å¸Œæœ›è¿™ä¸ªæŒ‡å—å¸®åŠ©ä½ ç†è§£äº†Tanvaæ¶æ„ä¸­OSS+CDNçš„è§’è‰²ï¼
