# Sealos éƒ¨ç½²å¿«é€Ÿå‘½ä»¤å‚è€ƒ

## ğŸš€ æœ¬åœ°æµ‹è¯•å‘½ä»¤

```bash
# å¯åŠ¨å®Œæ•´æœ¬åœ°ç¯å¢ƒï¼ˆåŒ…æ‹¬ PostgreSQLã€åç«¯ã€å‰ç«¯ï¼‰
docker-compose up -d

# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs backend
docker-compose logs frontend
docker-compose logs postgres

# è¿›å…¥åç«¯å®¹å™¨è¿è¡Œè¿ç§»
docker-compose exec backend npx prisma migrate deploy

# è¿›å…¥æ•°æ®åº“å®¹å™¨
docker-compose exec postgres psql -U postgres -d tanva

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰æ•°æ®ï¼ˆè°¨æ…ï¼ï¼‰
docker-compose down -v

# é‡å¯æŸä¸ªæœåŠ¡
docker-compose restart backend
```

## ğŸ³ Docker é•œåƒæ„å»ºå’Œæµ‹è¯•

```bash
# æ„å»ºå‰ç«¯é•œåƒ
docker build -f Dockerfile.frontend -t tanva-frontend:latest .

# æ„å»ºåç«¯é•œåƒ
docker build -f server/Dockerfile -t tanva-backend:latest .

# æ„å»ºæŒ‡å®šçš„é•œåƒç‰ˆæœ¬
docker build -f Dockerfile.frontend -t tanva-frontend:v1.0.0 .

# æŸ¥çœ‹æ„å»ºçš„é•œåƒ
docker images | grep tanva

# è¿è¡Œå‰ç«¯å®¹å™¨ï¼ˆæœ¬åœ°æµ‹è¯•ï¼‰
docker run -d -p 80:80 --name tanva-frontend tanva-frontend:latest

# è¿è¡Œåç«¯å®¹å™¨ï¼ˆæœ¬åœ°æµ‹è¯•ï¼‰
docker run -d -p 4000:4000 \
  -e DATABASE_URL="postgresql://postgres:pass@localhost:5432/tanva?schema=public" \
  -e JWT_ACCESS_SECRET="dev-secret" \
  --name tanva-backend tanva-backend:latest

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs tanva-backend
docker logs tanva-frontend

# è¿›å…¥å®¹å™¨å†…éƒ¨
docker exec -it tanva-backend /bin/sh
docker exec -it tanva-frontend /bin/sh

# åœæ­¢å®¹å™¨
docker stop tanva-frontend tanva-backend

# åˆ é™¤å®¹å™¨
docker rm tanva-frontend tanva-backend

# åˆ é™¤é•œåƒ
docker rmi tanva-frontend tanva-backend
```

## ğŸ”‘ å¯†é’¥ç”Ÿæˆå‘½ä»¤

```bash
# ç”Ÿæˆ 32 å­—ç¬¦åå…­è¿›åˆ¶éšæœºå­—ç¬¦ä¸²ï¼ˆç”¨äº JWT å’Œ Cookieï¼‰
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# ç”Ÿæˆå¤šä¸ªå¯†é’¥ï¼ˆbashï¼‰
for i in {1..3}; do
  echo "å¯†é’¥ $i:"
  node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
done

# ç”Ÿæˆ UUID æ ¼å¼çš„å¯†é’¥
node -e "console.log(require('crypto').randomUUID())"
```

## ğŸ“Š æ•°æ®åº“æ“ä½œ

```bash
# è¿æ¥åˆ°æœ¬åœ°æ•°æ®åº“
psql postgresql://postgres:tanva123456@localhost:5432/tanva

# åˆå§‹åŒ– Prismaï¼ˆåˆ›å»ºè¡¨ï¼‰
cd server && npx prisma migrate deploy

# ç”Ÿæˆ Prisma Client
cd server && npx prisma generate

# æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€
cd server && npx prisma studio

# é‡ç½®æ•°æ®åº“ï¼ˆåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
cd server && npx prisma migrate reset

# åˆ›å»ºæ–°è¿ç§»ï¼ˆå¼€å‘æ—¶ï¼‰
cd server && npx prisma migrate dev --name migration_name

# æŸ¥çœ‹æ‰€æœ‰è¿ç§»
cd server && npx prisma migrate status

# è¿è¡Œç‰¹å®šè¿ç§»ç‰ˆæœ¬
cd server && npx prisma migrate resolve --rolled-back migration_name
```

## ğŸ” ç½‘ç»œå’Œç«¯å£æ£€æŸ¥

```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼ˆmacOS/Linuxï¼‰
lsof -i :4000
lsof -i :5432
lsof -i :80

# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼ˆWindowsï¼‰
netstat -ano | findstr :4000
netstat -ano | findstr :5432
netstat -ano | findstr :80

# æµ‹è¯•æœåŠ¡æ˜¯å¦å¯è®¿é—®
curl http://localhost:4000/api/health
curl http://localhost:5432 2>&1 | head -1  # åº”è¯¥è¶…æ—¶æˆ–æ‹’ç»

# æŸ¥çœ‹å®¹å™¨ IP åœ°å€
docker inspect tanva-backend | grep IPAddress

# æµ‹è¯•å®¹å™¨ä¹‹é—´çš„ç½‘ç»œ
docker exec tanva-backend curl http://postgres:5432
```

## ğŸ“¦ æ–‡ä»¶æ“ä½œ

```bash
# æŸ¥çœ‹ Docker é•œåƒå¤§å°
docker images --format "table {{.Repository}}\t{{.Size}}"

# æŸ¥çœ‹ Docker ç³»ç»Ÿèµ„æºä½¿ç”¨
docker system df

# æ¸…ç†æœªä½¿ç”¨çš„ Docker èµ„æº
docker system prune

# æ¸…ç†åŒ…æ‹¬å·çš„æ‰€æœ‰æœªä½¿ç”¨èµ„æº
docker system prune -a --volumes

# æŸ¥çœ‹å®¹å™¨å†…æ–‡ä»¶
docker exec tanva-backend ls -la /app

# ä»å®¹å™¨å¤åˆ¶æ–‡ä»¶åˆ°æœ¬åœ°
docker cp tanva-backend:/app/dist ./dist-backup

# ä»æœ¬åœ°å¤åˆ¶æ–‡ä»¶åˆ°å®¹å™¨
docker cp ./file.txt tanva-backend:/app/
```

## ğŸ” Sealos å‘½ä»¤ï¼ˆå¦‚ä½¿ç”¨ CLIï¼‰

```bash
# ç™»å½• Sealos
sealos login --username your-username --password your-password

# è·å–æ‰€æœ‰åº”ç”¨
sealos get apps

# æŸ¥çœ‹ç‰¹å®šåº”ç”¨
sealos describe app tanva-backend

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
sealos logs tanva-backend

# è¿›å…¥åº”ç”¨å®¹å™¨
sealos exec tanva-backend -- /bin/sh

# è·å–åº”ç”¨ä¿¡æ¯
sealos get services

# æŸ¥çœ‹ Pod çŠ¶æ€
sealos get pods -n tanva

# æŸ¥çœ‹å­˜å‚¨çŠ¶æ€
sealos get pvc -n tanva

# é‡å¯åº”ç”¨
sealos restart tanva-backend
```

## ğŸš€ GitHub æ¨é€å’Œ CI/CD

```bash
# åˆå§‹åŒ– Gitï¼ˆé¦–æ¬¡ï¼‰
git init
git add .
git commit -m "Initial commit for Sealos deployment"
git remote add origin https://github.com/your-username/your-repo.git
git branch -M main
git push -u origin main

# åç»­æ¨é€
git add .
git commit -m "Update deployment configuration"
git push origin main

# æŸ¥çœ‹ Git çŠ¶æ€
git status

# æŸ¥çœ‹æäº¤å†å²
git log --oneline

# æŸ¥çœ‹ GitHub Actions çŠ¶æ€
# åœ¨ GitHub ä»“åº“ â†’ Actions æ ‡ç­¾ä¸­æŸ¥çœ‹
```

## ğŸ“ˆ æ€§èƒ½æµ‹è¯•å’Œç›‘æ§

```bash
# æµ‹è¯•åç«¯å“åº”æ—¶é—´
time curl http://localhost:4000/api/health

# å¹¶å‘æµ‹è¯•ï¼ˆéœ€è¦ Apache Benchï¼‰
ab -n 100 -c 10 http://localhost:4000/api/health

# å‹åŠ›æµ‹è¯•ï¼ˆéœ€è¦ wrkï¼‰
wrk -t12 -c400 -d30s http://localhost:4000/api/health

# æŸ¥çœ‹ Node.js è¿›ç¨‹å†…å­˜ä½¿ç”¨
docker stats tanva-backend

# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ
docker container stats
```

## ğŸ”§ æ•…éšœæ’æŸ¥å‘½ä»¤

```bash
# æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect tanva-backend

# æŸ¥çœ‹å®¹å™¨ç½‘ç»œé…ç½®
docker network inspect tanva-network

# éªŒè¯ Docker Compose é…ç½®æ–‡ä»¶
docker-compose config

# æµ‹è¯•æ•°æ®åº“è¿æ¥
docker exec tanva-backend curl postgres:5432

# æŸ¥çœ‹å®¹å™¨è¿›ç¨‹
docker exec tanva-backend ps aux

# æ£€æŸ¥ DNS è§£æï¼ˆå®¹å™¨å†…ï¼‰
docker exec tanva-backend cat /etc/resolv.conf

# æµ‹è¯• API è¿æ¥ï¼ˆè¯¦ç»†è¾“å‡ºï¼‰
curl -v http://localhost:4000/api/health

# æ˜¾ç¤º HTTP å“åº”å¤´
curl -i http://localhost:4000/api/health

# POST è¯·æ±‚æµ‹è¯•
curl -X POST http://localhost:4000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800138000","password":"Test@123"}'
```

## ğŸ§¹ æ¸…ç†å’Œç»´æŠ¤

```bash
# åˆ é™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨
docker container prune

# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒ
docker image prune

# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„ç½‘ç»œ
docker network prune

# åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„å·
docker volume prune

# å®Œæ•´ç³»ç»Ÿæ¸…ç†
docker system prune -a --volumes

# æŸ¥çœ‹ Docker ç£ç›˜ä½¿ç”¨
du -sh ~/.docker/

# æ¸…ç†æ—¥å¿—ï¼ˆè°¨æ…ï¼‰
docker logs --tail 1000 tanva-backend > backup.log
docker logs -f --tail 0 tanva-backend  # åªæ˜¾ç¤ºæ–°æ—¥å¿—
```

## ğŸ“ ç¯å¢ƒå˜é‡éªŒè¯

```bash
# æ£€æŸ¥åç«¯ç¯å¢ƒå˜é‡
docker exec tanva-backend printenv | grep -E "DATABASE_URL|JWT|COOKIE"

# æ£€æŸ¥å‰ç«¯æ„å»ºå‚æ•°
docker inspect tanva-frontend | grep VITE

# åˆ—å‡ºæ‰€æœ‰ç¯å¢ƒå˜é‡
docker exec tanva-backend printenv | sort
```

## ğŸ› å¸¸è§é—®é¢˜å¿«é€Ÿä¿®å¤

```bash
# é—®é¢˜ï¼šå®¹å™¨æ— æ³•è®¿é—® PostgreSQL
# è§£å†³ï¼šç¡®ä¿æ•°æ®åº“å®¹å™¨è¿è¡Œä¸­
docker ps | grep postgres

# é—®é¢˜ï¼šç«¯å£è¢«å ç”¨
# è§£å†³ï¼šä½¿ç”¨ä¸åŒçš„ç«¯å£
docker run -d -p 8000:4000 tanva-backend:latest

# é—®é¢˜ï¼šå†…å­˜ä¸è¶³
# è§£å†³ï¼šæŸ¥çœ‹å’Œé™åˆ¶å®¹å™¨å†…å­˜
docker stats
docker update --memory=512m tanva-backend

# é—®é¢˜ï¼šé•œåƒæ„å»ºå¤±è´¥
# è§£å†³ï¼šæ¸…ç†å¹¶é‡æ–°æ„å»º
docker builder prune
docker build --no-cache -f Dockerfile.frontend -t tanva-frontend:latest .

# é—®é¢˜ï¼šæ•°æ®åº“è¿æ¥è¶…æ—¶
# è§£å†³ï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥
docker exec tanva-backend nc -zv postgres 5432
```

## ğŸ“š å¿«é€Ÿå¸®åŠ©

```bash
# Docker å‘½ä»¤å¸®åŠ©
docker --help
docker run --help
docker-compose --help

# è·å–é•œåƒä¿¡æ¯
docker inspect tanva-backend:latest | jq '.[0].Config.Env'

# æŸ¥çœ‹å†å²å‘½ä»¤
history | grep docker
```

---

## ğŸ’¡ æŠ€å·§å’Œæœ€ä½³å®è·µ

```bash
# ä½¿ç”¨åˆ«åç®€åŒ–å‘½ä»¤
alias dc='docker-compose'
dc up -d
dc logs -f

# ä¸€æ¬¡æ€§æ„å»ºå’Œå¯åŠ¨
docker-compose build --no-cache && docker-compose up -d

# æŸ¥çœ‹å…¨éƒ¨æ—¥å¿—ï¼ˆåŒ…æ‹¬å·²é€€å‡ºçš„å®¹å™¨ï¼‰
docker logs --all tanva-backend

# ä½¿ç”¨æ ‡å‡†è¾“å‡ºè€Œä¸æ˜¯æ—¥å¿—æ–‡ä»¶
docker run -it tanva-backend:latest

# åå°å¯åŠ¨å¹¶ä¿å­˜æ—¥å¿—
docker-compose up -d && docker-compose logs -f > deployment.log &

# å®šæ—¶å¤‡ä»½æ•°æ®åº“
# æ¯å¤©è‡ªåŠ¨å¤‡ä»½åˆ° backup.sql
docker exec tanva-postgres pg_dump -U postgres tanva > backup-$(date +%Y%m%d).sql
```

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•å¿«é€Ÿå‘½ä»¤

```bash
# ä¸€é”®æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker-compose ps

# ä¸€é”®æ£€æŸ¥æ‰€æœ‰ç½‘ç»œè¿æ¥
docker exec tanva-backend curl -s http://postgres:5432 && echo "DB OK" || echo "DB FAILED"
docker exec tanva-backend curl -s http://localhost:4000/api/health && echo "API OK" || echo "API FAILED"

# ä¸€é”®æµ‹è¯•æ•°æ®åº“è¿ç§»
docker-compose exec backend npx prisma migrate status

# ä¸€é”®æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
docker system df
du -sh .
```

---

**æç¤º**ï¼šå¤§å¤šæ•°å‘½ä»¤éƒ½å¯ä»¥åˆ«ååŒ–ä»¥æé«˜æ•ˆç‡ã€‚ä¾‹å¦‚ï¼š
```bash
echo "alias dcup='docker-compose up -d'" >> ~/.bashrc
echo "alias dclogs='docker-compose logs -f'" >> ~/.bashrc
source ~/.bashrc
```

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼
