# 变更提案: flow_node_size_flash_home

## 元信息
```yaml
类型: 修复
方案类型: implementation
优先级: P1
状态: 草稿
创建: 2026-01-22
```

---

## 1. 需求

### 背景
从项目页点击 Logo 返回首页后，再点击“立即体验”进入同一项目时，Flow 中图片节点短暂出现尺寸异常放大，几秒后恢复正常。切换项目或首页刷新进入时未复现。

### 目标
- 进入项目后 Flow 节点不出现“初始放大”的短暂状态
- 图片节点尺寸在首屏渲染阶段保持正确
- 不影响节点布局、缩放、连线与交互

### 约束条件
```yaml
时间约束: 无
性能约束: 不引入明显卡顿或额外重排
兼容性约束: 保持现有浏览器兼容范围
业务约束: 无
```

### 验收标准
- [ ] 返回首页 → 点击“立即体验”进入同一项目后，图片节点尺寸从首屏即正确，无短暂放大
- [ ] 切换项目 / 刷新进入 / 首次进入等场景不受影响

---

## 2. 方案

### 技术方案
1) 排查进入项目时 Flow 的“尺寸计算/节点渲染”时序，识别是否存在初始尺寸为 0 或未测量导致的缩放回补。
2) 为图片节点尺寸计算加入“首屏测量稳定性兜底”，例如在节点尺寸未稳定前延迟更新布局或使用上次尺寸缓存。
3) 在 Flow 初始化恢复或节点渲染完成后触发一次“尺寸校准”，避免短暂放大后回落。

### 影响范围
```yaml
涉及模块:
  - frontend-flow: FlowOverlay / ImageNode 节点渲染尺寸
预计变更文件: 2-4
```

### 风险评估
| 风险 | 等级 | 应对 |
|------|------|------|
| 延迟渲染导致节点短暂空白 | 中 | 仅对图片节点首屏时使用稳定性门槛，避免全量延迟 |
| 尺寸缓存不一致导致布局偏移 | 中 | 只在测量无效时使用缓存，测量稳定后立即覆盖 |

---

## 3. 技术设计（可选）

> 不涉及架构/接口变更

---

## 4. 核心场景

### 场景: 返回首页再进入项目节点尺寸稳定
**模块**: Flow / 图片节点
**条件**: 返回首页 → 点击“立即体验”进入同一项目
**行为**: 观察图片节点初始渲染与数秒后的尺寸
**结果**: 首屏即为正确尺寸，无短暂放大

---

## 5. 技术决策

### flow_node_size_flash_home#D001: 使用首屏测量稳定性兜底解决图片节点短暂放大
**日期**: 2026-01-22
**状态**: ✅采纳
**背景**: 现象为短暂尺寸异常，疑似测量/渲染时序问题
**选项分析**:
| 选项 | 优点 | 缺点 |
|------|------|------|
| A: 强制延迟 Flow 初始化 | 简单粗暴 | 影响首屏与整体响应 |
| B: 仅图片节点首屏尺寸兜底 | 影响可控 | 需精确判断稳定时机 |
**决策**: 选择方案B
**理由**: 仅影响问题节点，风险可控
**影响**: `frontend/src/components/flow/FlowOverlay.tsx`、`frontend/src/components/flow/nodes/ImageNode.tsx`
